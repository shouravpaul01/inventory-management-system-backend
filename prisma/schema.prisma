generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                 String            @id @default(auto()) @map("_id") @db.ObjectId
  name               String
  email              String            @unique
  phone              String            @unique
  photo              String?
  role               UserRole
  roleBasedAccess    RoleBasedAccess[] @default([])
  status             UserStatus        @default(ACTIVE)
  needChangePassword Boolean           @default(true)
  isDeleted          Boolean           @default(false)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  credential UserCredential?

  @@map("users")
}

model UserCredential {
  id     String @id @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  password    String
  otp         String?
  otpExpireAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("user_credentials")
}

model Category {
  id             String          @id @map("_id") @db.ObjectId
  name           String          @unique
  status         Status          @default(ACTIVE)
  approvalStatus ApprovalStatus  @default(PENDING)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  subCategories  SubCategory[]
  inventoryItems InventoryItem[]

  @@map("categories")
}

model SubCategory {
  id             String         @id @map("_id") @db.ObjectId
  name           String         @unique
  status         Status         @default(ACTIVE)
  approvalStatus ApprovalStatus @default(PENDING)

  categoryId     String          @db.ObjectId
  category       Category        @relation(fields: [categoryId], references: [id])
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  inventoryItems InventoryItem[]

  @@map("sub_categories")
}

model CodeSequence {
  id             String         @id @map("_id") @db.ObjectId
  prefix         String         @unique
  nextNumber     Int            @default(1)
  approvalStatus ApprovalStatus @default(PENDING)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  inventoryItem  InventoryItem?

  @@map("code_sequences")
}

model InventoryItem {
  id          String       @id @default(auto()) @map("_id") @db.ObjectId
  baseCodeId  String       @unique @db.ObjectId
  baseCode    CodeSequence @relation(fields: [baseCodeId], references: [id])
  name        String       @unique
  description String?

  // Category
  categoryId    String      @db.ObjectId
  subCategoryId String      @db.ObjectId
  category      Category    @relation(fields: [categoryId], references: [id])
  subCategory   SubCategory @relation(fields: [subCategoryId], references: [id])

  // Stock Management
  totalQuantity       Int @default(0)
  availableQuantity   Int @default(0)
  reservedQuantity    Int @default(0)
  distributedQuantity Int @default(0)

  // Specifications
  specifications Json? // { brand: "", model: "", serial: "" }

  status         Status         @default(ACTIVE)
  approvalStatus ApprovalStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("inventory_items")
}

model AuditLog {
  id        String   @id @map("_id") @db.ObjectId
  userId    String
  action    String
  entity    String
  entityId  String
  oldValue  Json?
  newValue  Json?
  createdAt DateTime @default(now())
}

// -----Enum------ //
enum UserRole {
  USER
  ADMIN
}

enum UserStatus {
  ACTIVE
  BLOCKED
}

enum RoleBasedAccess {
  ALL
}

enum Status {
  ACTIVE
  INACTIVE
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}
