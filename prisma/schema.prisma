generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id                 String            @id @default(auto()) @map("_id") @db.ObjectId
  name               String
  email              String            @unique
  phone              String            @unique
  photo              String?
  role               UserRole
  roleBasedAccess    RoleBasedAccess[] @default([])
  status             UserStatus        @default(ACTIVE)
  needChangePassword Boolean           @default(true)
  isDeleted          Boolean           @default(false)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt

  credential UserCredential?

  @@map("users")
}

model UserCredential {
  id     String @id @map("_id") @db.ObjectId
  userId String @unique @db.ObjectId
  user   User   @relation(fields: [userId], references: [id])

  password    String
  otp         String?
  otpExpireAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("user_credentials")
}

model Room {
  id             String         @id @map("_id") @db.ObjectId
  floor          String
  roomNo         Int            @unique
  type           String
  images         String[]       @default([])
  description    String?
  specifications String?
  status         Status         @default(ACTIVE)
  approvalStatus ApprovalStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  stocks    Stock[]

  @@map("rooms")
}

model Category {
  id             String          @id @map("_id") @db.ObjectId
  name           String          @unique
  status         Status          @default(ACTIVE)
  approvalStatus ApprovalStatus  @default(PENDING)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  subCategories  SubCategory[]
  inventoryItems InventoryItem[]

  @@map("categories")
}

model SubCategory {
  id             String         @id @map("_id") @db.ObjectId
  name           String         @unique
  status         Status         @default(ACTIVE)
  approvalStatus ApprovalStatus @default(PENDING)

  categoryId     String          @db.ObjectId
  category       Category        @relation(fields: [categoryId], references: [id])
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  inventoryItems InventoryItem[]

  @@map("sub_categories")
}

model CodeSequence {
  id             String         @id @map("_id") @db.ObjectId
  prefix         String         @unique
  nextNumber     Int?
  approvalStatus ApprovalStatus @default(PENDING)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  inventoryItem  InventoryItem?

  @@map("code_sequences")
}

model InventoryItem {
  id             String       @id @default(auto()) @map("_id") @db.ObjectId
  baseCodeId     String       @unique @db.ObjectId
  baseCode       CodeSequence @relation(fields: [baseCodeId], references: [id])
  name           String       @unique
  description    String?
  specifications String?
  categoryId     String       @db.ObjectId
  subCategoryId  String       @db.ObjectId
  category       Category     @relation(fields: [categoryId], references: [id])
  subCategory    SubCategory  @relation(fields: [subCategoryId], references: [id])

  // Stock Management
  totalQuantity Int @default(0)

  availableQuantity   Int @default(0)
  distributedQuantity Int @default(0)

  totalCodes       String[] @default([])
  availableCodes   String[] @default([])
  distributedCodes String[] @default([])

  status         Status         @default(ACTIVE)
  approvalStatus ApprovalStatus @default(PENDING)
  type           ItemType

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  stocks    Stock[]

  @@map("inventory_items")
}

model Stock {
  id              String         @id @map("_id") @db.ObjectId
  inventoryItemId String         @db.ObjectId
  inventortyItem  InventoryItem  @relation(fields: [inventoryItemId], references: [id])
  quantity        Int
  codes           String[]       @default([])
  description     String?
  specifications  String?
  images          String[]       @default([])
  storedId        String?        @db.ObjectId
  store           Room?          @relation(fields: [storedId], references: [id])
  status          Status         @default(ACTIVE)
  approvalStatus  ApprovalStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("stocks")
}

model AuditLog {
  id        String   @id @map("_id") @db.ObjectId
  userId    String
  action    String
  entity    String
  entityId  String
  oldValue  Json?
  newValue  Json?
  createdAt DateTime @default(now())
}

// -----Enum------ //
enum UserRole {
  USER
  ADMIN
}

enum UserStatus {
  ACTIVE
  BLOCKED
}

enum RoleBasedAccess {
  ALL
}

enum Status {
  ACTIVE
  INACTIVE
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ItemType {
  RETURNABLE
  NONRETURNABLE
  GIFT
}
